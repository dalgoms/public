# 기사 수집 → 규칙 기반 초안 작성 → 자동 포스팅 프로세스

## 프로세스 개요

네이버 API로 기사를 수집하고, 수집한 원문을 활용하여 규칙 기반으로 초안을 작성한 후 WordPress에 자동 포스팅하는 완전 자동화 프로세스입니다.

---

## 전체 플로우 다이어그램

```
[HTTP 1] 네이버 뉴스 API 호출
    ↓
[Iterator 4] 뉴스 항목 배열 처리
    ↓
[Notion Search] 원문링크로 중복 체크
    ↓
[Router] Route 1: 신규 / Route 2: 중복
    ↓ (Route 1만)
[HTTP 5] 원문 내용 가져오기 (웹 스크래핑 또는 API)
    ↓
[Tools 6] Set Variable (규칙 기반 템플릿 설정)
    ↓
[OpenAI/ChatGPT 7] 규칙 기반 초안 작성
    ↓
[Notion 2] Create Database Item (초안 저장)
    ↓
[WordPress 8] Create a Post (Status: draft)
    ↓
[Tools 9] Text aggregator (이메일용)
    ↓
[Gmail 3] Send an Email (초안 완료 알림)
```

---

## 단계별 상세 설계

### 1단계: 기사 수집 (기존 플로우 활용)

**모듈: HTTP 1 → Iterator 4 → Notion Search → Router**

**설정:**
- 기존 "네이버 키워드 언론보도 수집 에이전트"의 HTTP 1, Iterator 4 모듈 재사용
- Notion Search로 중복 체크
- Router로 신규 항목만 필터링

**출력 데이터:**
- `4.title`: 기사 제목
- `4.link`: 원문 링크
- `4.description`: 기사 요약
- `4.pubDate`: 발행일

---

### 2단계: 원문 내용 가져오기

**모듈: HTTP 5 (원문 스크래핑)**

**목적:** 원문 링크에서 실제 기사 본문 내용 추출

**설정:**

| 설정 항목 | 값 | 설명 |
|-----------|-----|------|
| **URL** | `{{4.link}}` | Iterator 4의 원문 링크 |
| **Method** | `GET` | - |
| **Parse** | `Yes` | HTML 파싱 활성화 |

**대안 방법:**

**방법 A: Make.com의 Webhook/HTTP 모듈 사용**
- HTTP 모듈로 원문 페이지 가져오기
- HTML 파싱으로 본문 추출

**방법 B: 외부 스크래핑 서비스 활용**
- ScraperAPI, ScrapingBee 등 서비스 사용
- 또는 Make.com의 "Extract from HTML" 모듈 사용

**방법 C: RSS/API 활용 (가능한 경우)**
- 네이버 뉴스 API의 `description` 필드 활용
- 또는 RSS 피드에서 본문 가져오기

**출력 데이터:**
- `5.data`: 원문 HTML 또는 텍스트
- `5.text`: 파싱된 본문 텍스트

---

### 3단계: 규칙 기반 템플릿 설정

**모듈: Tools 6 (Set Variable)**

**목적:** 블로그 포스팅 초안 작성을 위한 규칙과 템플릿 설정

**변수 설정:**

| 변수명 | 값 | 설명 |
|--------|-----|------|
| `blog_template` | 아래 템플릿 참고 | 블로그 포스팅 템플릿 |
| `brand_tone` | `전문적이고 친근한 톤` | 브랜드 톤앤매너 |
| `target_audience` | `마케터, 비즈니스 전문가` | 타겟 독자 |
| `seo_keywords` | `{{4.title}}`에서 키워드 추출 | SEO 키워드 |

**템플릿 예시:**

```
제목: {{4.title}}에 대한 심층 분석

[서론]
{{4.title}} 관련 최신 동향을 분석합니다.

[본문]
{{5.text}} (원문 내용을 요약 및 재구성)

[결론]
이번 기사를 통해 {{keyword}}에 대한 인사이트를 얻을 수 있습니다.

[출처]
원문: {{4.link}}
발행일: {{4.pubDate}}
```

---

### 4단계: AI를 활용한 규칙 기반 초안 작성

**모듈: OpenAI 7 (Create a Chat Completion) 또는 ChatGPT API**

**목적:** 수집한 원문을 규칙에 따라 블로그 포스팅 초안으로 변환

**프롬프트 설계:**

```
당신은 전문 블로그 작가입니다. 아래 규칙에 따라 뉴스 기사를 블로그 포스팅 초안으로 작성해주세요.

[규칙]
1. 제목: 원문 제목을 SEO 친화적으로 재작성
2. 서론: 독자의 관심을 끄는 2-3문장
3. 본문: 원문 내용을 요약하고 분석 (500-800자)
4. 결론: 핵심 인사이트와 행동 제안
5. 톤앤매너: 전문적이지만 친근한 톤
6. SEO: 자연스럽게 키워드 포함

[원문 제목]
{{4.title}}

[원문 내용]
{{5.text}}

[원문 링크]
{{4.link}}

[발행일]
{{4.pubDate}}

위 규칙에 따라 블로그 포스팅 초안을 작성해주세요.
```

**OpenAI 모듈 설정:**

| 설정 항목 | 값 |
|-----------|-----|
| **Model** | `gpt-4` 또는 `gpt-3.5-turbo` |
| **Messages** | 위 프롬프트 사용 |
| **Max Tokens** | `2000` |
| **Temperature** | `0.7` |

**출력 데이터:**
- `7.choices[].message.content`: 생성된 초안 텍스트

---

### 5단계: Notion에 초안 저장

**모듈: Notion 2 (Create Database Item)**

**목적:** 생성된 초안을 Notion에 저장하여 관리

**Notion DB 구조:**

| 속성명 | 타입 | 매핑 값 |
|--------|------|---------|
| **제목** | Title | `{{4.title}}` |
| **초안 내용** | Text | `{{7.choices[].message.content}}` |
| **원문링크** | URL | `{{4.link}}` |
| **발행일** | Date | `{{4.pubDate}}` |
| **포스팅 상태** | Select | `초안 완료` |
| **카테고리** | Select | `뉴스` |

**설정:**
- Iterator 4의 출력을 사용하여 각 항목마다 초안 저장

---

### 6단계: WordPress에 초안 포스팅

**모듈: WordPress 8 (Create a Post)**

**목적:** 생성된 초안을 WordPress에 자동 포스팅 (초안 상태)

**설정:**

| 필드 | 값 | 설명 |
|------|-----|------|
| **Title** | `{{4.title}}` | 원문 제목 또는 AI가 생성한 제목 |
| **Content** | `{{7.choices[].message.content}}` | AI가 생성한 초안 |
| **Status** | `draft` | ⚠️ **초안으로 저장** (수동 검토 후 발행) |
| **Categories** | `["뉴스"]` | 고정 카테고리 |
| **Tags** | `["자동화", "뉴스레터"]` | 고정 태그 |

**고급 설정 (선택사항):**

- **Excerpt**: `{{substring(7.choices[].message.content; 0; 150)}}` (초안의 첫 150자)
- **Custom Fields**: 원문 링크 저장

---

### 7단계: 완료 알림 이메일 발송

**모듈: Tools 9 (Text Aggregator) → Gmail 3**

**목적:** 초안 생성 완료 알림

**Text Aggregator 템플릿:**

```html
<div style="font-family: 'Pretendard', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
<h2 style="color: #333;">블로그 포스팅 초안 생성 완료</h2>
<p>다음 기사의 초안이 생성되었습니다:</p>
<ul>
<li><strong>{{4.title}}</strong></li>
<li>원문: <a href="{{4.link}}">{{4.link}}</a></li>
<li>WordPress 초안: <a href="{{8.link}}">초안 보기</a></li>
</ul>
<p>WordPress에서 검토 후 발행해주세요.</p>
</div>
```

**Gmail 설정:**
- **To**: (본인 이메일)
- **Subject**: `블로그 초안 생성 완료: {{4.title}}`
- **Content**: `{{9.text}}` (Raw HTML)

---

## 전체 프로세스 설정 가이드

### 모듈 순서 및 연결

1. **HTTP 1**: 네이버 뉴스 API 호출
2. **Iterator 4**: 뉴스 항목 배열 처리 (Map: ON, Array: `1.data.items[]`)
3. **Notion Search**: 원문링크로 중복 체크
4. **Router**: Route 1 (신규) / Route 2 (중복)
5. **HTTP 5**: 원문 내용 가져오기 (Route 1만)
6. **Tools 6**: Set Variable (템플릿 규칙 설정)
7. **OpenAI 7**: 규칙 기반 초안 작성
8. **Notion 2**: 초안 저장
9. **WordPress 8**: 초안 포스팅 (draft)
10. **Tools 9**: Text Aggregator
11. **Gmail 3**: 완료 알림

---

### 규칙 기반 초안 작성 규칙 예시

#### 규칙 1: 제목 작성 규칙

```
- 원문 제목을 SEO 친화적으로 재작성
- 30-50자 이내
- 핵심 키워드 포함
- 클릭을 유도하는 형식
```

#### 규칙 2: 서론 작성 규칙

```
- 독자의 관심을 끄는 질문 또는 통계로 시작
- 2-3문장으로 구성
- 본문에서 다룰 내용을 간략히 소개
```

#### 규칙 3: 본문 작성 규칙

```
- 원문 내용을 요약 (500-800자)
- 핵심 포인트 3-5개 추출
- 각 포인트마다 간단한 설명 추가
- 전문 용어는 쉬운 표현으로 풀어서 설명
```

#### 규칙 4: 결론 작성 규칙

```
- 핵심 인사이트 요약
- 독자에게 행동 제안 (예: "이번 동향을 주시하세요")
- 관련 링크 또는 다음 단계 제시
```

#### 규칙 5: 톤앤매너

```
- 전문적이지만 친근한 톤
- 과도한 전문 용어 지양
- 독자와의 소통을 느낄 수 있는 문체
```

---

### AI 프롬프트 템플릿 (상세 버전)

```
당신은 전문 블로그 작가입니다. 아래 규칙에 따라 뉴스 기사를 블로그 포스팅 초안으로 작성해주세요.

[작성 규칙]

1. 제목 작성
   - 원문 제목을 SEO 친화적으로 재작성
   - 30-50자 이내
   - 핵심 키워드 포함
   - 클릭을 유도하는 형식

2. 서론 작성
   - 독자의 관심을 끄는 질문 또는 통계로 시작
   - 2-3문장으로 구성
   - 본문에서 다룰 내용을 간략히 소개

3. 본문 작성
   - 원문 내용을 요약 (500-800자)
   - 핵심 포인트 3-5개 추출
   - 각 포인트마다 간단한 설명 추가
   - 전문 용어는 쉬운 표현으로 풀어서 설명

4. 결론 작성
   - 핵심 인사이트 요약
   - 독자에게 행동 제안
   - 관련 링크 또는 다음 단계 제시

5. 톤앤매너
   - 전문적이지만 친근한 톤
   - 과도한 전문 용어 지양
   - 독자와의 소통을 느낄 수 있는 문체

[원문 정보]
제목: {{4.title}}
내용: {{5.text}}
링크: {{4.link}}
발행일: {{4.pubDate}}

[출력 형식]
제목: [생성된 제목]

[서론]
[서론 내용]

[본문]
[본문 내용]

[결론]
[결론 내용]

[출처]
원문: {{4.link}}
발행일: {{4.pubDate}}

위 규칙에 따라 블로그 포스팅 초안을 작성해주세요.
```

---

## 고급 기능 추가

### 1. 카테고리 자동 분류

**방법:**
- AI에게 카테고리 분류 요청
- 또는 키워드 기반 규칙으로 분류

**프롬프트 예시:**
```
위 기사를 다음 카테고리 중 하나로 분류해주세요:
- 뉴스
- IT/기술
- 비즈니스
- 마케팅

카테고리만 출력해주세요.
```

### 2. 태그 자동 생성

**방법:**
- AI에게 태그 생성 요청
- 또는 키워드 추출로 태그 생성

**프롬프트 예시:**
```
위 기사에 적합한 태그 3-5개를 생성해주세요.
태그만 쉼표로 구분하여 출력해주세요.
```

### 3. 이미지 자동 추가

**방법:**
- 원문에서 이미지 URL 추출
- 또는 Unsplash API로 관련 이미지 검색

**설정:**
- WordPress Featured Image 필드에 이미지 URL 매핑

### 4. SEO 최적화

**방법:**
- AI에게 메타 설명 생성 요청
- Yoast SEO 플러그인 커스텀 필드 활용

**프롬프트 예시:**
```
위 포스팅의 SEO 메타 설명을 150자 이내로 작성해주세요.
```

---

## 트러블슈팅

### 문제 1: 원문 내용을 가져오지 못함

**원인:**
- 웹 스크래핑 차단
- 동적 콘텐츠 (JavaScript 렌더링 필요)

**해결 방법:**
- ScraperAPI 같은 전문 서비스 사용
- 또는 네이버 API의 `description` 필드 활용 (제한적)

### 문제 2: AI 초안 품질이 일정하지 않음

**원인:**
- 프롬프트가 모호함
- Temperature 설정이 높음

**해결 방법:**
- 프롬프트를 더 구체적으로 작성
- Temperature를 0.3-0.5로 낮춤
- Few-shot 예시 추가

### 문제 3: 비용이 많이 듦

**원인:**
- OpenAI API 호출 비용
- 원문이 길어서 토큰 사용량 증가

**해결 방법:**
- GPT-3.5-turbo 사용 (GPT-4보다 저렴)
- 원문 요약 후 AI에 전달
- Max Tokens 제한 설정

---

## 비용 예상

### Make.com
- **Free 플랜**: 월 1,000 operations (제한적)
- **Core 플랜**: 월 $9 (10,000 operations)
- **Pro 플랜**: 월 $29 (40,000 operations)

### OpenAI API
- **GPT-3.5-turbo**: $0.0015/1K tokens (입력), $0.002/1K tokens (출력)
- **GPT-4**: $0.03/1K tokens (입력), $0.06/1K tokens (출력)

**예상 비용 (하루 10건 기준):**
- 입력 토큰: 약 2,000 tokens/건 × 10건 = 20,000 tokens
- 출력 토큰: 약 1,000 tokens/건 × 10건 = 10,000 tokens
- GPT-3.5-turbo: 약 $0.05/일 ($1.5/월)
- GPT-4: 약 $0.90/일 ($27/월)

---

## 최종 체크리스트

- [ ] HTTP 1 모듈 설정 (네이버 API)
- [ ] Iterator 4 모듈 설정 (Map: ON)
- [ ] Notion Search 모듈 설정 (중복 체크)
- [ ] Router 모듈 설정 (신규/중복 분기)
- [ ] HTTP 5 모듈 설정 (원문 가져오기)
- [ ] Tools 6 모듈 설정 (템플릿 규칙)
- [ ] OpenAI 7 모듈 설정 (API 키, 프롬프트)
- [ ] Notion 2 모듈 설정 (초안 저장)
- [ ] WordPress 8 모듈 설정 (초안 포스팅)
- [ ] Tools 9 모듈 설정 (이메일 템플릿)
- [ ] Gmail 3 모듈 설정 (알림 발송)
- [ ] 테스트 실행 및 검증

---

## 참고 자료

- [네이버 키워드 언론보도 수집 에이전트](./네이버_키워드_언론보도_수집_에이전트.md)
- [워드프레스 자동 포스팅 방법 비교 가이드](./워드프레스_자동포스팅_방법_비교_가이드.md)
- [OpenAI API 문서](https://platform.openai.com/docs)
- [Make.com 문서](https://www.make.com/en/help)
